<!DOCTYPE html>
<html lang="en-US">
   <head>
      <meta charset="UTF-8">
      <meta name="viewport" content="width=device-width" />
      <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">

<title>Vitess - SchemaManagement</title>
<meta name="description" content="Servers and tools that scale MySQL databases for the web in cloud architectures or on dedicated hardware.">

<link rel="canonical" href="http://vitess.io/doc/SchemaManagement/">

<!-- Add to homescreen for Chrome on Android -->
<meta name="mobile-web-app-capable" content="yes">
<link rel="icon" sizes="196x196" href="/images/touch/chrome-touch-icon-196x196.png">

<!-- Add to homescreen for Safari on iOS -->
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black">
<meta name="apple-mobile-web-app-title" content="Vitess">

<!-- Tile icon for Win8 (144x144 + tile color) -->
<meta name="msapplication-TileImage" content="/images/touch/ms-touch-icon-144x144-precomposed.png">
<meta name="msapplication-TileColor" content="#3372DF">

          <!-- Webfont -->
    <link href='http://fonts.googleapis.com/css?family=Roboto:400,100,100italic,300,300italic,400italic,500,500italic,700,700italic,900,900italic' rel='stylesheet' type='text/css'>
    
    <!--<link rel="shortcut icon" type="image/png" href="/favicon.png">-->

    <!-- Bootstrap -->
    <link href="/libs/bootstrap/css/bootstrap.min.css" rel="stylesheet">

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->

    <!-- Less custom stylesheet -->
    <link rel="stylesheet/less" type="text/css" href="/css/style.less" />
    <link rel="stylesheet" type="text/css" href="/css/vitess.css">
    <!-- Font Awesome icons -->
    <link href="/libs/font-awesome-4.4.0/css/font-awesome.min.css"
          rel="stylesheet"
          type="text/css">
    
    <!-- Less clientside js script after all less stylesheets. -->
    <script src="/libs/less/less.min.js" type="text/javascript"></script>
    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <script src="/libs/bootstrap/js/bootstrap.min.js"></script>

      <link rel="stylesheet" href="/css/components.css">
      <link rel="stylesheet" href="/css/responsee.css">
      <!-- CUSTOM STYLE -->
      <link rel="stylesheet" href="/css/template-style.css">
      <link href='http://fonts.googleapis.com/css?family=Open+Sans:400,300,600,700,800&subset=latin,latin-ext' rel='stylesheet' type='text/css'>
      <script type="text/javascript" src="/assets/scripts/jquery-1.8.3.min.js"></script>
      <script type="text/javascript" src="/assets/scripts/jquery-ui.min.js"></script>    
      <script type="text/javascript" src="/assets/scripts/modernizr.js"></script>
      <script type="text/javascript" src="/assets/scripts/responsee.js"></script>
      <!--[if lt IE 9]>
      <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
      <![endif]-->
   </head>
   <body class="size-1140">
      <header id="app-bar" class="app-bar promote-layer">
         <div class="line">
            <div class="app-bar-container">
               <button id="menu" class="menu" title="Menu"></button>
               <h1 class="logo"><a href="/">Vitess</a></h1>
               <section class="app-bar-actions">
                  <a href="#"><i class="icon icon-chevron-up"></i> Top</a>
               </section>
            </div>
            <div class="navdrawer">
              <nav id="nav" class="navdrawer-container promote-layer">
                <h4>Navigation</h4>
                
<ul>
  
    <li >
      <a href="//"></a>
    </li>
  
    <li >
      <a href="/overview/">Guides</a>
    </li>
  
    <li >
      <a href="/reference/vtctl.html">Reference</a>
    </li>
  
  <li><a href="https://github.com/youtube/vitess">GitHub</a></li>
</ul>

              </nav>
            </div>
         </div>
      </header>
      <!-- ASIDE NAV AND CONTENT -->
      <div class="line">
         <div class="box  margin-bottom">
            <div class="margin">
               <!-- ASIDE NAV 2 -->
               <nav class="scrolling-nav" style="margin:0">
               <aside class="s-12">
                  
                  <div class="aside-nav">
                     <div class="aside-nav-header">Overview</div>
                     <ul>
                        <li><a href="/overview/">What is Vitess</a></li>
                        <li><a href="/overview/concepts.html">Key Concepts</a></li>
                     </ul>
                     <div class="aside-nav-header">Getting Started</div>
                     <ul>
                        <li><a href="/getting-started/">Run Vitess on Kubernetes</a></li>
                        <li><a href="/getting-started/local-instance.html">Run Vitess Locally</a></li>
                     </ul>
                     <div class="aside-nav-header">User Guide</div>
                     <ul>
                        <li><a href="/user-guide/introduction.html">Introduction</a>
                        <li><a href="/user-guide/client-libraries.html">Client Libraries</a>
                        <li><a href="/user-guide/backup-and-restore.html">Backing Up Data</a>
                        <li><a href="/user-guide/reparenting.html">Reparenting</a></li>
                        <li><a href="/user-guide/schema-management.html">Schema Management</a></li>
                        <li><a href="/user-guide/sharding.html">Sharding</a>
                          <ul>
                            <li><a href="/user-guide/horizontal-sharding.html">Horizontal Sharding (Codelab)</a></li>
                            <li><a href="/user-guide/sharding-kubernetes.html">Sharding in Kubernetes (Codelab)</a></li>
                          </ul>
                        </li>
<!--
                        <li><a href="/user-guide/storage.html">Storage</a></li>
                        <li><a href="/user-guide/api.html">Using the API</a></li>
-->
                     </ul>
<!--
                     <div class="aside-nav-header">Architecture</div>
                     <ul>
                        <li><a href="/architecture/life-of-a-query.html">Life of a Query</a></li>
                        <li><a href="/architecture/topology-service.html">Topology Service</a></li>
                     </ul>

                     <div class="aside-nav-header">Maintenance</div>
                     <ul>
                        <li><a href="/maintenance/monitoring.html">Monitoring</a></li>
                        <li><a href="/maintenance/testing.html">Testing</a></li>
                     </ul>
-->
                     <div class="aside-nav-header">Other Resources</div>
                     <ul>
                        <li><a href="/resources/presentations.html">Presentations</a></li>
                        <!--<li class="last"><a href="/resources/roadmap.html">Roadmap</a></li>-->
                     </ul>
                  </div>
                  
               </aside>
               </nav>
               <!-- CONTENT -->
               <section class="s-12 l-9">
                 <article class="main-content-container">
                   <main class="clear">

  <header class="page-header container">
    <h2 class="xxlarge text-divider">SchemaManagement</h2>
    
  </header>

  <div class="container">
    <p>Your MySQL database schema lists the tables in your database and
contains table definitions that explain how to create those tables.
Table definitions identify table names, column names, column types,
primary key information, and so forth.</p>

<p>This document describes the <code><a href="/reference/vtctl.html">vtctl</a></code>
commands that you can use to <a href="#reviewing-your-schema">review</a> or
<a href="#changing-your-schema">update</a> your schema in Vitess.</p>

<h2 id="reviewing-your-schema">Reviewing your schema</h2>

<p>This section describes the following <code>vtctl</code> commands, which let you look at the schema and validate its consistency across tablets or shards:</p>

<ul>
<li><a href="#getschema">GetSchema</a></li>
<li><a href="#validateschemashard">ValidateSchemaShard</a></li>
<li><a href="#validateschemakeyspace">ValidateSchemaKeyspace</a></li>
</ul>

<h3 id="getschema">GetSchema</h3>

<p>The <code><a href="/reference/vtctl.html#getschema">GetSchema</a></code> command
displays the full schema for a tablet or a subset of the tablet&#39;s tables.
When you call <code>GetSchema</code>, you specify the tablet alias that
uniquely identifies the tablet. The <code>&lt;tablet alias&gt;</code>
argument value has the format <code>&lt;cell name&gt;-&lt;uid&gt;</code>.</p>

<p><strong>Note:</strong> You can use the
<code><a href="/reference/vtctl.html#listalltablets">vtctl ListAllTablets</a></code>
command to retrieve a list of tablets in a cell and their unique IDs.</p>

<p>The following example retrieves the schema for the tablet with the
unique ID <code>test-000000100</code>:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">GetSchema test-000000100
</code></pre></div>
<h3 id="validateschemashard">ValidateSchemaShard</h3>

<p>The
<code><a href="/reference/vtctl.html#validateschemashard">ValidateSchemaShard</a></code>
command confirms that for a given keyspace, all of the slave tablets
in a specified shard have the same schema as the master tablet in that
shard. When you call <code>ValidateSchemaShard</code>, you specify both
the keyspace and the shard that you are validating.</p>

<p>The following command confirms that the master and slave tablets in
shard <code>0</code> all have the same schema for the <code>user</code>
keyspace:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">ValidateSchemaShard user/0
</code></pre></div>
<h3 id="validateschemakeyspace">ValidateSchemaKeyspace</h3>

<p>The <code><a href="/reference/vtctl.html#validateschemakeyspace">ValidateSchemaKeyspace</a></code>
command confirms that all of the tablets in a given keyspace have
the the same schema as the master tablet on shard <code>0</code>
in that keyspace. Thus, whereas the <code>ValidateSchemaShard</code>
command confirms the consistency of the schema on tablets within a shard
for a given keyspace, <code>ValidateSchemaKeyspace</code> confirms the
consistency across all tablets in all shards for that keyspace.</p>

<p>The following command confirms that all tablets in all shards have the
same schema as the master tablet in shard <code>0</code> for the
<code>user</code> keyspace:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">ValidateSchemaKeyspace user
</code></pre></div>
<h2 id="changing-your-schema">Changing your schema</h2>

<p>This section describes the <code>vtctl ApplySchema</code> command, which
supports schema modifications. Vitess&#39; schema modification functionality
is designed the following goals in mind:</p>

<ul>
<li>Enable simple updates that propagate to your entire fleet of servers.</li>
<li>Require minimal human interaction.</li>
<li>Minimize errors by testing changes against a temporary database.</li>
<li>Guarantee very little downtime (or no downtime) for most schema updates.</li>
<li>Do not store permanent schema data in the topology server.</li>
</ul>

<p>Note that, at this time, Vitess only supports
<a href="https://dev.mysql.com/doc/refman/5.6/en/sql-syntax-data-definition.html">data definition statements</a>
that create, modify, or delete database tables.
For instance, <code>ApplySchema</code> does not affect stored procedures
or grants.</p>

<h3 id="applyschema">ApplySchema</h3>

<p>The <code><a href="/reference/vtctl.html#applyschema">ApplySchema</a></code>
command applies a schema change to the specified keyspace on every
master tablet, running in parallel on all shards. Changes are then
propagated to slaves via replication. The command format is:
<code class="prettyprint">
ApplySchema {-sql=&lt;sql&gt; || -sql_file=&lt;filename&gt;} &lt;keyspace&gt;
</code></p>

<p>When the <code>ApplySchema</code> action actually applies a schema
change to the specified keyspace, it performs the following steps:</p>

<ol>
<li>It finds shards that belong to the keyspace, including newly added
shards if a <a href="/user-guide/sharding.html#resharding">resharding event</a>
has taken place.</li>
<li>It validates the SQL syntax and determines the impact of the schema
change. If the scope of the change is too large, Vitess rejects it.
See the <a href="#permitted-schema-changes">permitted schema changes</a> section
for more detail.</li>
<li>It employs a pre-flight check to ensure that a schema update will
succeed before the change is actually applied to the live database.
In this stage, Vitess copies the current schema into a temporary
database, applies the change there to validate it, and retrieves
the resulting schema. By doing so, Vitess verifies that the change
succeeds without actually touching live database tables.</li>
<li>It applies the Sql command on the master tablet in each shard.</li>
</ol>

<p>The following sample command applies the SQL in the <strong>user_table.sql</strong>
file to the <strong>user</strong> keyspace:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">ApplySchema -sql_file=user_table.sql user
</code></pre></div>
<h4 id="permitted-schema-changes">Permitted schema changes</h4>

<p>The <code>ApplySchema</code> command supports a limited set of DDL
statements. In addition, Vitess rejects some schema changes because
large changes can slow replication and may reduce the availability
of your overall system.</p>

<p>The following list identifies types of DDL statements that Vitess
supports:</p>

<ul>
<li><code>CREATE TABLE</code></li>
<li><code>CREATE INDEX</code></li>
<li><code>CREATE VIEW</code></li>
<li><code>ALTER TABLE</code></li>
<li><code>ALTER VIEW</code></li>
<li><code>RENAME TABLE</code></li>
<li><code>DROP TABLE</code></li>
<li><code>DROP INDEX</code></li>
<li><code>DROP VIEW</code></li>
</ul>

<p>In addition, Vitess applies the following rules when assessing the
impact of a potential change:</p>

<ul>
<li><code>DROP</code> statements are always allowed, regardless of the
table&#39;s size.</li>
<li><code>ALTER</code> statements are only allowed if the table on the
shard&#39;s master tablet has 100,000 rows or less.</li>
<li>For all other statements, the table on the shard&#39;s master tablet
must have 2 million rows or less.</li>
</ul>

  </div>

</main>

                 </article>
               </section>
            </div>
         </div>
         <footer>
            <div class="s-12">
               <div style="float: left; display: inline-block; width: 50%;">&copy; 2015 Google. Licensed under <a href="http://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a>.</div>
               <div style="float: right; display: inline-block; text-align: right; width: 50%;">Design and coding based on <a href="http://www.myresponsee.com" title="Responsee - lightweight responsive framework">Responsee</a> framework</div>
               </div>
         </footer>
      </div>
      <!-- FOOTER -->

      <script src="/assets/scripts/main.js"></script>

      <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  if (window.location.hostname == 'youtube.github.io') {
    ga('create', 'UA-60219601-1', 'auto');
    ga('send', 'pageview');
  }
</script>

   </body>
</html>
