<!DOCTYPE html>
<html lang="en" class="no-js">
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">

<title>Vitess - Concepts</title>
<meta name="description" content="A set of servers and tools that facilitate scaling of MySQL databases for the web.">

<link rel="canonical" href="http://vitess.io/doc/Concepts/">

<!-- Add to homescreen for Chrome on Android -->
<meta name="mobile-web-app-capable" content="yes">
<link rel="icon" sizes="196x196" href="/images/touch/chrome-touch-icon-196x196.png">

<!-- Add to homescreen for Safari on iOS -->
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black">
<meta name="apple-mobile-web-app-title" content="Vitess">

<!-- Tile icon for Win8 (144x144 + tile color) -->
<meta name="msapplication-TileImage" content="/images/touch/ms-touch-icon-144x144-precomposed.png">
<meta name="msapplication-TileColor" content="#3372DF">

<link rel="stylesheet" href="/assets/vendor/styles/wsk.css">
<link rel="stylesheet" href="/css/main.css">
<link rel="stylesheet" href="/css/extra.css">
<link rel="stylesheet" href="http://fonts.googleapis.com/css?family=Roboto:300,600,900|Roboto+Condensed:300,300italic,400,700">

</head>
<body class="">

<header id="app-bar" class="app-bar promote-layer">
  <div class="app-bar-container">
    <button id="menu" class="menu" title="Menu"></button>
    <h1 class="logo"><a href="/">Vitess</a></h1>
    <section class="app-bar-actions">
      <a href="#"><i class="icon icon-chevron-up"></i> Top</a>
    </section>
  </div>
</header>

<div class="navdrawer">
  <nav id="nav" class="navdrawer-container promote-layer">
    <h4>Navigation</h4>
    
<ul>
  
    <li >
      <a href="http://vitess.io//"></a>
    </li>
  
    <li >
      <a href="http://vitess.io/overview/">Overview</a>
    </li>
  
    <li >
      <a href="http://vitess.io/getting-started/">Getting Started</a>
    </li>
  
  <li><a href="https://github.com/youtube/vitess">GitHub</a></li>
</ul>

  </nav>
</div>

<main class="clear">

  <header class="page-header container">
    <h2 class="xxlarge text-divider">Concepts</h2>
    
  </header>

  <div class="container">
    <h1 id="concepts">Concepts</h1>

<p>We need to introduce some common terminologies that are used in Vitess:</p>

<h3 id="keyspace">Keyspace</h3>

<p>A keyspace is a logical database.
In its simplest form, it directly maps to a MySQL database name.
When you read data from a keyspace, it is as if you read from a MySQL database.
Vitess could fetch that data from a master or a replica depending
on the consistency requirements of the read.</p>

<p>When a database gets <a href="http://en.wikipedia.org/wiki/Shard_(database_architecture)">sharded</a>,
a keyspace maps to multiple MySQL databases,
and the necessary data is fetched from one of the shards.
Reading from a keyspace gives you the impression that the data is read from
a single MySQL database.</p>

<h3 id="shard">Shard</h3>

<p>A division within a Keyspace. All the instances inside a Shard have the same data (or should have the same data,
modulo some replication lag).</p>

<p>A Keyspace usually has one shard when not using any sharding (we name it &#39;0&#39; by convention). When sharded, a Keyspace will have N shards (usually, N is a power of 2) with non-overlapping data.</p>

<p>We support <a href="http://vitess.io/doc/Resharding">dynamic resharding</a>, when one shard is split into two shards for instance. In this case, the data in the
source shard is duplicated into the two destination shards, but only during the transition. Afterwards, the source shard is
deleted.</p>

<p>A shard usually contains one MySQL master, and many MySQL slaves. The slaves are used to serve read-only traffic (with
eventual consistency guarantees), run data analysis tools that take a long time to run, or perform administrative tasks (backups, restore, diffs, ...)</p>

<h3 id="tablet">Tablet</h3>

<p>A tablet is a single server that runs:
- a MySQL instance
- a vttablet instance
- a local row cache instance
- an other per-db process that is necessary for operational purposes</p>

<p>It can be idle (not assigned to any keyspace), or assigned to a keyspace/shard. If it becomes unhealthy, it is usually changed to scrap.</p>

<p>It has a type. The commonly used types are:
- master: for the mysql master, RW database.
- replica: for a mysql slave that serves read-only traffic, with guaranteed low replication latency.
- rdonly: for a mysql slave that serves read-only traffic for backend processing jobs (like map-reduce type jobs). It has no real guaranteed replication latency.
- spare: for a mysql slave not used at the moment (hot spare).
- experimental, schema, lag, backup, restore, checker, ... : various types for specific purposes.</p>

<p>Only master, replica and rdonly are advertised in the Serving Graph.</p>

<h3 id="keyspace-id">Keyspace id</h3>

<p>A keyspace id (keyspace_id) is a column that is used to identify a primary entity
of a keyspace, like user, video, order, etc.
In order to shard a database, all tables in a keyspace need to
contain a keyspace id column.
Vitess sharding ensures that all rows that have a common keyspace id are
always together.</p>

<p>It&#39;s recommended, but not necessary, that the keyspace id be the leading primary
key column of all tables in a keyspace.</p>

<p>If you do not intend to shard a database, you do not have to
designate a keyspace_id.
However, you&#39;ll be required to designate a keyspace_id
if you decide to shard a currently unsharded database.</p>

<p>A keyspace_id can be an unsigned number or a binary character column (unsigned bigint
or varbinary in mysql tables). Other data types are not allowed because of ambiguous
equality or inequality rules.</p>

<p>TODO: The keyspace id rules need to be solidified once VTGate features are finalized.</p>

<h3 id="shard-graph">Shard graph</h3>

<p>The shard graph defines how a keyspace has been sharded. It&#39;s basically a per-keyspace
list of non-intersecting ranges that cover all possible values a keyspace id can cover.
In other words, any given keyspace id is guaranteed to map to one and only one
shard of the shard graph.</p>

<p>We are going with range based sharding.
The main advantage of this scheme is that the shard map is a simple in-memory lookup.
The downside of this scheme is that it creates hot-spots for sequentially increasing keys.
In such cases, we recommend that the application hashes the keys so they
distribute more randomly.</p>

<p>For instance, an application may use an incrementing UserId as a primary key for user records,
and a hashed version of that UserId as a keyspace_id. All data related to one user will be on
the same shard, as all rows will share that keyspace_id.</p>

<h3 id="replication-graph">Replication graph</h3>

<p>The <a href="http://vitess.io/doc/ReplicationGraph">Replication Graph</a> represents the relationships between the master
databases and their respective replicas.
This data is particularly useful during a master failover.
Once a new master has been designated, all existing replicas have to
repointed to the new master so that replication can resume.</p>

<h3 id="serving-graph">Serving graph</h3>

<p>The <a href="http://vitess.io/doc/ServingGraph">Serving Graph</a> is derived from the shard and replication graph.
It represents the list of active servers that are available to serve
queries.
VTGate (or smart clients) query the serving graph to find out which servers
they are allowed to send queries to.</p>

<h3 id="topology-server">Topology Server</h3>

<p>The Topology Server is the backend service used to store the Topology data, and provide a locking service. The implementation we use in the tree is based on Zookeeper. Each Zookeeper process is run on a single server, but may share that server with other processes.</p>

<p>There is a global instance of that service. It contains data that doesn&#39;t change often, and references other local instances. It may be replicated locally in each Data Center as read-only copies. (a Zookeeper instance with two master instances per cell and one or two replicas per cell is a good configuration).</p>

<p>There is one local instance of that service per Cell (Data Center). The goal is to transparently support a Cell going down. When that happens, we assume the client traffic is drained out of that Cell, and the system can survive
using the remaining Cells. (a Zookeeper instance running on 3 or 5 hosts locally is a good configuration).</p>

<p>The data is partitioned as follows:
- Keyspaces: global instance
- Shards: global instance
- Tablets: local instances
- Serving Graph: local instances
- Replication Graph: the master alias is in the global instance, the master-slave map is in the local cells.</p>

<p>Clients usually just read the local Serving Graph, therefore they only need the local instance to be up. Also, we provide a caching layer for Zookeeper, to survive local Zookeeper failures and scale read-only access dramatically.</p>

<h3 id="cell-(data-center)">Cell (Data Center)</h3>

<p>A Cell is a group of servers and network infrastructure collocated in an area. It is usually a full Data Center, or a subset of a full Data Center.</p>

<p>A Cell has an associated Topology Server, hosted in that Cell. Most information about the tablets in a cell is hosted in that cell&#39;s Topology Server. That way a Cell can be taken down and rebuilt as a unit, for instance.</p>

<p>We try to limit cross-cell traffic (both for data and metadata), and gracefully handle cell-level failures (like a Cell being cut off the network). Having the ability to route client traffic to Cells individually is a great feature to have
(but not provided by the Vitess software).</p>

  </div>

</main>


<footer>
  <div class="container">
    <p class="small">&copy; 2015 Google. Licensed under <a href="http://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a>.</p>
  </div>
</footer>

<script src="/assets/scripts/main.js"></script>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  if (window.location.hostname == 'youtube.github.io') {
    ga('create', 'UA-60219601-1', 'auto');
    ga('send', 'pageview');
  }
</script>

</body>
</html>

